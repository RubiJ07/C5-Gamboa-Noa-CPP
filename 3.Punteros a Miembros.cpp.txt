#include <iostream>
#include <stdexcept>
using namespace std;

// ==================== CLASE BASE CArray ====================
template <typename T>
class CArray {
protected:
    T* m_data;
    int m_size;
    int m_capacity;

public:
    CArray() : m_data(nullptr), m_size(0), m_capacity(0) {}
    
    ~CArray() { 
        delete[] m_data; 
    }

    void resize(int newCap) {
        T* tmp = new T[newCap];
        for (int i = 0; i < m_size; i++) 
            tmp[i] = m_data[i];
        delete[] m_data;
        m_data = tmp;
        m_capacity = newCap;
    }

    T& operator[](int i) { return m_data[i]; }
    int size() const { return m_size; }
    bool empty() const { return m_size == 0; }
};

// ==================== CLASE PILA (Stack) ====================
template <typename T>
class CStack : public CArray<T> {
public:
    // INSERCIÓN (push)
    void push(const T& val) {
        if (this->m_size == this->m_capacity)
            this->resize(this->m_capacity == 0 ? 4 : this->m_capacity * 2);
        this->m_data[this->m_size++] = val;
    }

    // ELIMINACIÓN (pop)
    T pop() {
        if (this->empty()) throw underflow_error("Pila vacia");
        return this->m_data[--this->m_size];
    }

    // BÚSQUEDA por valor
    int search(const T& val) const {
        for (int i = this->m_size - 1; i >= 0; i--)
            if (this->m_data[i] == val)
                return (this->m_size - 1 - i); // 0 = tope
        return -1;
    }

    // CONSULTA del tope
    T& top() {
        if (this->empty()) throw underflow_error("Pila vacia");
        return this->m_data[this->m_size - 1];
    }

    // ELIMINACIÓN por valor
    bool removeByValue(const T& val) {
        for (int i = this->m_size - 1; i >= 0; i--) {
            if (this->m_data[i] == val) {
                for (int j = i; j < this->m_size - 1; j++)
                    this->m_data[j] = this->m_data[j + 1];
                this->m_size--;
                return true;
            }
        }
        return false;
    }

    // ELIMINACIÓN por índice
    T removeByIndex(int idx) {
        int realIdx = this->m_size - 1 - idx;
        if (realIdx < 0 || realIdx >= this->m_size)
            throw out_of_range("Indice fuera de rango");
        T val = this->m_data[realIdx];
        for (int j = realIdx; j < this->m_size - 1; j++)
            this->m_data[j] = this->m_data[j + 1];
        this->m_size--;
        return val;
    }

    // MOSTRAR contenido
    void mostrar() const {
        cout << "Pila (tope > fondo): [";
        for (int i = this->m_size - 1; i >= 0; i--) {
            cout << this->m_data[i];
            if (i > 0) cout << ", ";
        }
        cout << "]" << endl;
    }
};

// ==================== MAIN ====================
int main() {
    cout << "========================================" << endl;
    cout << "  IMPLEMENTACION DE PILA (STACK)" << endl;
    cout << "========================================\n" << endl;

    CStack<int> pila;

    // 1. INSERCIÓN
    cout << "1. INSERCION (push):" << endl;
    cout << "   Insertando: 10, 20, 30, 40, 50" << endl;
    pila.push(10);
    pila.push(20);
    pila.push(30);
    pila.push(40);
    pila.push(50);
    cout << "   ";
    pila.mostrar();
    cout << "   Tamanio: " << pila.size() << "\n" << endl;

    // 2. CONSULTA
    cout << "2. CONSULTA (top):" << endl;
    cout << "   Tope: " << pila.top() << "\n" << endl;

    // 3. BÚSQUEDA
    cout << "3. BUSQUEDA (search):" << endl;
    cout << "   Buscar 20: pos " << pila.search(20) << endl;
    cout << "   Buscar 10: pos " << pila.search(10) << endl;
    cout << "   Buscar 99: pos " << pila.search(99) << " (no encontrado)\n" << endl;

    // 4. POP
    cout << "4. ELIMINACION (pop):" << endl;
    cout << "   Eliminado: " << pila.pop() << endl;
    cout << "   ";
    pila.mostrar();
    cout << endl;

    // 5. ELIMINAR POR VALOR
    cout << "5. ELIMINACION POR VALOR:" << endl;
    cout << "   Eliminar 20: " << (pila.removeByValue(20) ? "exitoso" : "fallido") << endl;
    cout << "   ";
    pila.mostrar();
    cout << endl;

    // 6. ELIMINAR POR ÍNDICE
    cout << "6. ELIMINACION POR INDICE:" << endl;
    cout << "   Eliminar indice 1: " << pila.removeByIndex(1) << endl;
    cout << "   ";
    pila.mostrar();
    cout << endl;

    // 7. VACIAR
    cout << "7. VACIAR PILA:" << endl;
    while (!pila.empty()) {
        cout << "   pop: " << pila.pop() << endl;
    }
    cout << "   ";
    pila.mostrar();
    cout << "   Vacia: " << (pila.empty() ? "Si" : "No") << "\n" << endl;

    cout << "========================================" << endl;
    cout << "  PRUEBA COMPLETADA" << endl;
    cout << "========================================" << endl;

    return 0;
}
